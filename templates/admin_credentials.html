{% extends 'base.html' %}

{% block content %}
<section class="card">
  <h2>Credenciales de usuarios</h2>
  <p>Registra o actualiza credenciales para derivadores y técnicos.</p>
  <form method="post" action="{{ url_for('admin_credentials') }}" class="grid">
    <input type="hidden" name="action" value="upsert" />
    <label>
      Rol
      <select name="role" required>
        <option value="dispatcher">Derivador</option>
        <option value="technician">Técnico</option>
      </select>
    </label>
    <label>
      Identificador
      <input type="text" name="identifier" required placeholder="correo o usuario" />
    </label>
    <label class="full">
      Nueva contraseña
      <input type="password" name="password" required />
    </label>
    <button type="submit">Guardar credencial</button>
  </form>
</section>

<section class="card">
  <h2>Actualizar contraseña de administrador</h2>
  <form method="post" action="{{ url_for('admin_credentials') }}" class="grid">
    <input type="hidden" name="action" value="update_admin" />
    <label>
      Usuario
      <input type="text" value="{{ user.identifier }}" disabled />
    </label>
    <label>
      Nueva contraseña
      <input type="password" name="password" required />
    </label>
    <button type="submit">Actualizar contraseña</button>
  </form>
</section>

<section class="card">
  <h2>Credenciales registradas</h2>
  <div class="table">
    <div class="table-row header">
      <span>Rol</span>
      <span>Identificador</span>
      <span>Último acceso</span>
    </div>
    {% for user in users %}
    <div class="table-row">
      <span>{{ user['role'] }}</span>
      <span>{{ user['identifier'] }}</span>
      <span>{{ user['last_login'] or 'Sin acceso' }}</span>
    </div>
    {% else %}
    <p>No hay credenciales registradas.</p>
    {% endfor %}
  </div>
</section>

<section class="card">
  <h2>Técnicos activos</h2>
  <ul>
    {% for tech in technicians %}
    <li>{{ tech['name'] }} — {{ tech['email'] }}</li>
    {% endfor %}
  </ul>
</section>
{% endblock %}
